{% extends 'layout.html' %} {% block nav %}
<ul class="nav nav-pills nav-fill">
  {% if role == 1 %}
  <li class="nav-item">
    <a class="nav-link active" href="{{ url_for('attendance') }}">Attendance</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('assignment') }}">Assignment</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('timetable') }}">Time Table</a>
  </li>
  {% else %}
  <li class="nav-item">
    <a class="nav-link active" href="{{ url_for('lec_attendance') }}"
      >Lec Attendance</a
    >
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('lec_assignment') }}"
      >Lec Assignment</a
    >
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('lec_timetable') }}">Lec Timetable</a>
  </li>
  {% endif %}
</ul>
{% endblock %} {% block content %}
<style>
  .table-wrap {
    overflow-x: scroll;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 1rem;
    color: #212529;
    background: #fff;
    -webkit-box-shadow: 0px 5px 12px -12px rgba(0, 0, 0, 0.29);
    -moz-box-shadow: 0px 5px 12px -12px rgba(0, 0, 0, 0.29);
    box-shadow: 0px 5px 12px -12px rgba(0, 0, 0, 0.29);
  }
  .table-wrap::-webkit-scrollbar {
    display: none;
  }
  th {
    text-align: inherit;
  }
  .table thead.thead-primary {
    background: #80c3d6;
  }
  .table tbody th,
  .table tbody td {
    border: none;
    padding: 15px;
    font-size: 15px;
    background: #fff;
    border-bottom: 4px solid #f8f9fd;
    vertical-align: middle;
  }
  .table thead th {
    border: none;
    padding: 27px;
    font-size: 15px;
    font-weight: 700;
    color: white;
  }
</style>
<div class="container">
  <div id="accordion">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button
            class="btn btn-link"
            data-toggle="collapse"
            data-target="#collapseOne"
            aria-expanded="true"
            aria-controls="collapseOne"
          >
            Attendance Submission
          </button>
        </h5>
      </div>

      <div
        id="collapseOne"
        class="collapse show"
        aria-labelledby="headingOne"
        data-parent="#accordion"
      >
        <div class="card-body">
          <h6 class="text-warning">Please mark your attendance within the first 15 minutes of the class.</h6>
          <form class="getSubjectCode" action="/getSubjectAttendace" method="POST">
            <label for="">Checkin Code :</label>
            <select class="js-example-basic-single" id="mySelect" name="subject" style="width: 100%">
              {% for item in subjectList %}
              <option value="{{item[0]}}">{{item[1]}}</option>
              {% endfor %}
            </select>
            <button id="btnSearch" class="btn btn-sm btn-primary mt-3" type="submit">
              Search
            </button>
          </form>
          <!-- Show attendance data -->
          {% if attendanceList %}
          <div class="card mt-3">
            <div class="card-header">{{attendanceList[0]}}</div>
            <form action="/clockin" method="POST">
              <div class="card-body">
                <h5 class="card-title">{{attendanceList[1]}}</h5>
                <p class="card-text">Start Time : {{ attendanceList[3] }} <br /> End Time : {{ attendanceList[4] }}</p>
                <p class="card-text"></p>
                <input type="hidden" name="attendanceId" id="attendanceId" value="{{attendanceList[5]}}"/>
                <inpuT type="hidden" name="attendanceStartTime" id="attendanceStartTime" value="{{attendanceList[3]}}"/>
                <input type="hidden" name="attendanceEndTime" id="attendanceEndTime" value="{{attendanceList[4]}}"/>
                <button id="btnClockIn" class="btn btn-sm btn-primary mt-3" type="submit">
                  Clock In
                </button>
              </div>
            </form>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Attendance History
          </button>
        </h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
        <div class="card-body">
          <p class="text-left">Total Class Sessions: 20</p>
          <div class="progress mb-3">
            <div class="progress-bar" role="progressbar" style="width: {{ percentAttend }}%;" aria-valuenow="{{percent}}" ria-valuemin="0" aria-valuemax="100"></div>
            <div class="progress-bar bg-warning" role="progressbar" style="width: {{percentLate}}%" aria-valuenow="{{percentLate}}" aria-valuemin="0" aria-valuemax="100"></div>
            <div class="progress-bar bg-danger" role="progressbar" style="width: {{percentAbsence}}%" aria-valuenow="{{percentAbsence}}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="table-wrap">
                <table class="table">
                  <thead class="thead-primary">
                    <tr>
                      <th>Course Code</th>
                      <th>Class Session</th>
                      <th>Attendance Status</th>
                      <th>Check In/ Backdate</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in attendaceHistory %}
                    <tr class="alert" role="alert">
                      <td>{{item[1]}}</td>
                      <td>{{item[0]}}</td>
                      {% if item[2] == 1 %}
                      <td>Pending</td>
                      {% elif item[2] == 2 %}
                      <td>Present</td>
                      {% elif item[2] == 3 %}
                      <td>Late</td>
                      {% elif item[2] == 4 %}
                      <td>Absent</td>
                      {% else%}
                      <td>Pending</td>
                      {% endif %} {% if item[2] == 1 %}
                      <td>-</td>
                      {% else %}
                      <td>{{item[3]}}</td>
                      {% endif %}
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function() {
      $('#mySelect').select2();
      var selectedSubject = {{selectedSubject|default('null') }};
      if(selectedSubject){
        $('#mySelect').val(selectedSubject).trigger('change');
      }
  });
</script>
{% endblock %}
